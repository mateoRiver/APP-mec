<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MECON Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: white;
            padding-bottom: 80px;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            color: #0f172a;
            padding: 40px 30px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 420px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-box h1 {
            text-align: center;
            margin-bottom: 8px;
            font-size: 32px;
            font-weight: 800;
        }

        .login-box p {
            text-align: center;
            margin-bottom: 32px;
            color: #64748b;
            font-size: 15px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
        }

        .error-message {
            color: #ef4444;
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
            font-weight: 500;
            display: none;
        }

        .credentials-info {
            margin-top: 24px;
            padding: 16px;
            background: #f1f5f9;
            border-radius: 12px;
            font-size: 13px;
            color: #64748b;
            line-height: 1.6;
        }

        .credentials-info strong {
            color: #0f172a;
            display: block;
            margin-bottom: 8px;
        }

        .credentials-info code {
            background: #e2e8f0;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            color: #0f172a;
            font-weight: 600;
        }

        .dashboard {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px 12px;
        }

        .dashboard.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff 0%, #cbd5e1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .date-filter {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 13px;
            color: #cbd5e1;
        }

        .filter-group select {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            cursor: pointer;
        }

        .filter-group select option {
            background: #1e293b;
            color: white;
        }

        .btn-filter {
            padding: 10px 20px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 28px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .stat-card h3 {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 12px;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .value {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #cbd5e1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card .description {
            font-size: 14px;
            margin-bottom: 16px;
            opacity: 0.8;
            line-height: 1.5;
        }

        .stat-card .change {
            font-size: 14px;
            font-weight: 600;
            margin-top: 12px;
            padding: 6px 12px;
            border-radius: 8px;
            display: inline-block;
        }

        .stat-card .change.positive {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        .stat-card .change.negative {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
        }

        .stat-card .change.neutral {
            background: rgba(148, 163, 184, 0.2);
            color: #cbd5e1;
        }

        .stat-card .view-more {
            margin-top: 16px;
            font-size: 13px;
            color: #60a5fa;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .chart-detail {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px 16px;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .chart-detail h2 {
            color: white;
            margin-bottom: 16px;
            font-size: 20px;
            font-weight: 700;
            line-height: 1.3;
        }

        .chart-wrapper {
            position: relative;
            height: 600px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            padding: 30px 20px 20px 20px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 24px;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(-4px);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
            display: none;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
        }

        .bottom-nav.active {
            display: flex;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 20px;
            cursor: pointer;
            color: #94a3b8;
            transition: all 0.3s;
            border: none;
            background: none;
            font-family: 'Inter', sans-serif;
            position: relative;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 0 0 3px 3px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .nav-item.active::before {
            opacity: 1;
        }

        .nav-item.active {
            color: #3b82f6;
        }

        .nav-item .icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-item .label {
            font-size: 11px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 22px; }
            .stat-card .value { font-size: 40px; }
            .chart-wrapper { height: 550px; padding: 25px 16px 16px 16px; }
            .stats-grid { grid-template-columns: 1fr; }
            .chart-detail { padding: 20px 12px; }
            .chart-detail h2 { font-size: 18px; margin-bottom: 16px; }
            .date-filter { padding: 16px; }
        }

        @media (max-width: 480px) {
            .dashboard { padding: 12px; }
            .stat-card { padding: 24px; }
            .chart-wrapper { height: 500px; padding: 20px 12px 12px 12px; }
            .chart-detail { padding: 16px 8px; }
            .chart-detail h2 { font-size: 16px; }
            .date-filter { padding: 12px; }
            .filter-group { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h1>MECON</h1>
            <p>Datos Oficiales</p>
            <div class="input-group">
                <label for="username">Usuario</label>
                <input type="text" id="username" placeholder="Ingrese su usuario">
            </div>
            <div class="input-group">
                <label for="password">Contrase√±a</label>
                <input type="password" id="password" placeholder="Ingrese su contrase√±a">
            </div>
            <button class="login-btn" onclick="login()">Ingresar</button>
            <div class="error-message" id="errorMessage">Usuario o contrase√±a incorrectos</div>
            <div class="credentials-info">
                <strong>Credenciales de prueba:</strong>
                Usuario: <code>admin</code> / Contrase√±a: <code>argentina2025</code><br>
                Usuario: <code>usuario</code> / Contrase√±a: <code>123456</code>
            </div>
        </div>
    </div>

    <div id="dashboard" class="dashboard">
        <div class="header">
            <h1>MECON Dashboard</h1>
            <div class="header-buttons">
                <button class="btn btn-primary" onclick="descargarExcel()">
                    <span>üì•</span><span>Descargar Excel</span>
                </button>
                <button class="btn btn-secondary" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>
        </div>

        <div id="resumenSection" class="section active">
            <div class="stats-grid">
                <div class="stat-card" onclick="showSection('mensual')">
                    <h3>Inflaci√≥n Diciembre 2025</h3>
                    <div class="value">2.8%</div>
                    <div class="description">√öltimo dato mensual</div>
                    <div class="change neutral">A√±o 2025: 31.5%</div>
                    <div class="view-more">Ver evoluci√≥n ‚Üí</div>
                </div>
                <div class="stat-card" onclick="showSection('interanual')">
                    <h3>Inflaci√≥n Interanual</h3>
                    <div class="value">31.5%</div>
                    <div class="description">Dic 2025 vs Dic 2024</div>
                    <div class="change negative">‚Üì Menor desde 2017</div>
                    <div class="view-more">Ver evoluci√≥n ‚Üí</div>
                </div>
                <div class="stat-card" onclick="showSection('emae')">
                    <h3>EMAE Noviembre 2025</h3>
                    <div class="value">152.4</div>
                    <div class="description">Desestacionalizado</div>
                    <div class="change neutral">Base 2004=100</div>
                    <div class="view-more">Ver serie ‚Üí</div>
                </div>
                <div class="stat-card" onclick="showSection('bcra')">
                    <h3>Base Monetaria</h3>
                    <div class="value">41.9B</div>
                    <div class="description">27 Enero 2026</div>
                    <div class="change neutral">Millones de pesos</div>
                    <div class="view-more">Ver serie ‚Üí</div>
                </div>
            </div>
        </div>

        <div id="mensualSection" class="section">
            <button class="back-btn" onclick="showSection('resumen')">‚Üê Volver</button>
            <div class="date-filter">
                <div class="filter-group">
                    <label>Desde</label>
                    <select id="fechaDesde"></select>
                </div>
                <div class="filter-group">
                    <label>Hasta</label>
                    <select id="fechaHasta"></select>
                </div>
                <button class="btn-filter" onclick="aplicarFiltroMensual()">Aplicar</button>
            </div>
            <div class="chart-detail">
                <h2>Inflaci√≥n Mensual y EMAE</h2>
                <div class="chart-wrapper">
                    <canvas id="inflacionMensualChart"></canvas>
                </div>
            </div>
        </div>

        <div id="interanualSection" class="section">
            <button class="back-btn" onclick="showSection('resumen')">‚Üê Volver</button>
            <div class="date-filter">
                <div class="filter-group">
                    <label>Desde</label>
                    <select id="fechaDesdeInteranual"></select>
                </div>
                <div class="filter-group">
                    <label>Hasta</label>
                    <select id="fechaHastaInteranual"></select>
                </div>
                <button class="btn-filter" onclick="aplicarFiltroInteranual()">Aplicar</button>
            </div>
            <div class="chart-detail">
                <h2>Inflaci√≥n Interanual Mensual</h2>
                <div class="chart-wrapper">
                    <canvas id="inflacionInteranualChart"></canvas>
                </div>
            </div>
        </div>

        <div id="emaeSection" class="section">
            <button class="back-btn" onclick="showSection('resumen')">‚Üê Volver</button>
            <div class="date-filter">
                <div class="filter-group">
                    <label>Desde</label>
                    <select id="fechaDesdeEmae"></select>
                </div>
                <div class="filter-group">
                    <label>Hasta</label>
                    <select id="fechaHastaEmae"></select>
                </div>
                <button class="btn-filter" onclick="aplicarFiltroEmae()">Aplicar</button>
            </div>
            <div class="chart-detail">
                <h2>EMAE Desestacionalizado (Base 2004=100)</h2>
                <div class="chart-wrapper">
                    <canvas id="emaeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN BCRA -->
        <div id="bcraSection" class="section">
            <button class="back-btn" onclick="showSection('resumen')">‚Üê Volver</button>
            
            <div class="chart-detail">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
                    <h2 style="margin: 0;">Archivo Compartido</h2>
                    <button class="btn btn-secondary" onclick="mostrarModalUpload()" style="padding: 8px 16px; font-size: 13px;">
                        <span>üìÅ</span>
                        <span>Subir Archivo</span>
                    </button>
                </div>
                
                <!-- Visor de archivo -->
                <div id="visorArchivo" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 400px; background: rgba(255,255,255,0.05); border-radius: 16px; padding: 40px 20px;">
                    <div style="font-size: 64px; margin-bottom: 20px;">üìÑ</div>
                    <h3 style="color: white; margin: 0 0 12px 0; font-size: 24px;">Sin archivos</h3>
                    <p style="color: #94a3b8; margin: 0 0 24px 0; text-align: center; max-width: 400px;" id="infoArchivo">
                        No hay archivos cargados
                    </p>
                </div>
                
                <p style="font-size: 12px; opacity: 0.6; margin-top: 12px; text-align: center;" id="lastUpdate">
                    Sin datos cargados
                </p>
            </div>
        </div>

        <!-- MODAL DE UPLOAD SIMPLIFICADO -->
        <div id="modalUploadBCRA" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center; overflow-y: auto; padding: 20px;">
            <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 20px; padding: 30px 20px; max-width: 500px; width: 100%; margin: auto; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); position: relative;">
                
                <!-- Bot√≥n X para cerrar -->
                <button onclick="cerrarModalSinCargar()" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.1); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; z-index: 1;">
                    ‚úï
                </button>
                
                <h2 style="color: white; margin: 0 0 12px 0; font-size: 22px; padding-right: 40px;">üìÅ Archivo Compartido</h2>
                <p style="color: #94a3b8; margin: 0 0 20px 0; line-height: 1.5; font-size: 14px;">
                    Selecciona una opci√≥n:
                </p>

                <!-- Opci√≥n 1: Ver archivo del admin -->
                <div id="opcionAdmin" style="display: none; background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; border-radius: 12px; padding: 16px; margin-bottom: 16px; cursor: pointer;" onclick="verArchivoAdmin()">
                    <p style="color: #22c55e; margin: 0 0 8px 0; font-size: 14px; font-weight: 600;">‚úÖ Ver archivo del administrador</p>
                    <p id="infoAdmin" style="color: #94a3b8; margin: 0; font-size: 13px;"></p>
                </div>

                <!-- Opci√≥n 2: Subir archivo (SOLO ADMIN) -->
                <div id="opcionSubir" style="display: none; background: rgba(59, 130, 246, 0.1); border: 2px dashed #3b82f6; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;" onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 40px; margin-bottom: 8px;">üìÅ</div>
                    <p style="color: #60a5fa; margin: 0 0 4px 0; font-weight: 600; font-size: 14px;">Subir archivo</p>
                    <p style="color: #94a3b8; margin: 0; font-size: 12px;">Cualquier tipo de archivo</p>
                    <input type="file" id="fileInput" style="display: none;" onchange="procesarArchivo(event)">
                </div>

                <div id="uploadStatus" style="display: none; padding: 12px; border-radius: 8px; margin-top: 16px; font-size: 13px;"></div>

                <button id="btnContinuar" onclick="cerrarModalUpload()" disabled style="width: 100%; margin-top: 16px; padding: 12px 16px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: not-allowed; font-size: 14px; font-weight: 600; opacity: 0.5; transition: all 0.3s;">
                    Continuar
                </button>
            </div>
        </div>
    </div>

    <div id="bottomNav" class="bottom-nav">
        <button class="nav-item active" onclick="showSection('resumen')">
            <div class="icon">üìä</div>
            <div class="label">Resumen</div>
        </button>
        <button class="nav-item" onclick="showSection('mensual')">
            <div class="icon">üìà</div>
            <div class="label">Mensual</div>
        </button>
        <button class="nav-item" onclick="showSection('interanual')">
            <div class="icon">üìâ</div>
            <div class="label">Interanual</div>
        </button>
        <button class="nav-item" onclick="showSection('emae')">
            <div class="icon">üìä</div>
            <div class="label">EMAE</div>
        </button>
        <button class="nav-item" onclick="showSection('bcra')">
            <div class="icon">üè¶</div>
            <div class="label">BCRA</div>
        </button>
    </div>

    <script>
        // ==========================================
        // USUARIOS Y DATOS
        // ==========================================
        const validUsers = {'admin': 'argentina2025', 'usuario': '123456'};
        let chartMensual, chartInteranual, chartEmae, chartBcra;
        let chartsInitialized = false;

        const todosMeses = ['Nov 23', 'Dic 23', 'Ene 24', 'Feb 24', 'Mar 24', 'Abr 24', 'May 24', 'Jun 24', 
                            'Jul 24', 'Ago 24', 'Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 
                            'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 
                            'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25', 'Nov 25', 'Dic 25'];
        
        const todosInflacionMensual = [12.8, 25.5, 20.6, 13.2, 11.0, 8.8, 4.2, 4.6, 
                                       4.0, 4.2, 3.5, 2.7, 2.4, 2.7,
                                       2.2, 2.4, 3.7, 2.8, 1.5, 1.6,
                                       1.9, 1.9, 2.1, 2.3, 2.5, 2.8];

        const todosInflacionInteranual = [160.9, 211.4, 254.2, 276.2, 287.9, 289.4, 263.4, 236.7,
                                          215.1, 209.8, 193.1, 166.5, 152.9, 117.8,
                                          84.5, 82.5, 79.0, 75.5, 67.5, 63.3,
                                          58.0, 54.2, 50.8, 47.5, 31.4, 31.5];

        const todosEmae = [146.4, 143.3, 143.9, 143.9, 142.9, 141.0, 142.6, 143.6, 
                          147.1, 147.8, 147.7, 148.7, 150.4, 152.2, 
                          152.2, 153.4, 150.7, 152.4, 152.2, 151.5,
                          151.5, 152.5, 153.4, 152.8, 152.4, null];

        // Datos BCRA - Base Monetaria (en millones de pesos)
        // Fuente: Excel del BCRA - Variable ID 71 (Saldo de base monetaria)
        // Datos diarios: 1 Nov 2025 - 27 Ene 2026 (57 d√≠as h√°biles)
        let fechasBCRA = [
            '2025-11-01', '2025-11-03', '2025-11-04', '2025-11-05', '2025-11-07', '2025-11-10', '2025-11-11', '2025-11-12', '2025-11-13', '2025-11-14',
            '2025-11-17', '2025-11-18', '2025-11-19', '2025-11-20', '2025-11-25', '2025-11-26', '2025-11-27', '2025-11-28', '2025-12-01', '2025-12-01',
            '2025-12-02', '2025-12-03', '2025-12-04', '2025-12-05', '2025-12-09', '2025-12-10', '2025-12-11', '2025-12-12', '2025-12-15', '2025-12-16',
            '2025-12-17', '2025-12-18', '2025-12-19', '2025-12-22', '2025-12-23', '2025-12-26', '2025-12-29', '2025-12-30', '2026-01-01', '2026-01-02',
            '2026-01-05', '2026-01-06', '2026-01-07', '2026-01-08', '2026-01-09', '2026-01-12', '2026-01-13', '2026-01-14', '2026-01-15', '2026-01-16',
            '2026-01-19', '2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23', '2026-01-26', '2026-01-27'
        ];
        
        let baseMonetaria = [
            40938039, 41437306, 40730943, 41136124, 41881861, 41632920, 40036417, 40264655, 39820024, 40285409,
            40819556, 40323072, 40314551, 40927869, 42341489, 40563401, 41009226, 40926609, 40862891, 40921357,
            39684092, 37842747, 40457720, 38933317, 40069791, 40146702, 40856240, 41173306, 41443740, 40768621,
            41112794, 40972242, 40805912, 41416844, 41853086, 42492789, 42305192, 42956965, 43446368, 42960320,
            42683047, 42682795, 43167152, 43272002, 42895272, 42938346, 43346010, 43803268, 43701459, 44102114,
            44050201, 44040732, 44265806, 44262398, 44254340, 43364675, 41880963
        ];

        let filtroMensualDesde = 0;
        let filtroMensualHasta = todosMeses.length - 1;
        let filtroInteranualDesde = 0;
        let filtroInteranualHasta = todosMeses.length - 1;
        let filtroEmaeDesde = 0;
        let filtroEmaeHasta = todosMeses.length - 2;

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');

            if (validUsers[username] && validUsers[username] === password) {
                // Resetear estado de BCRA antes de entrar
                window.bcraDataLoaded = false;
                window.bcraFileData = null;
                window.bcraFileName = null;
                window.bcraFileSource = null;
                fechasBCRA = [];
                baseMonetaria = [];
                
                // Resetear bot√≥n de descarga
                const btnDescargar = document.getElementById('btnDescargarBCRA');
                if (btnDescargar) {
                    btnDescargar.disabled = true;
                    btnDescargar.style.opacity = '0.5';
                    btnDescargar.style.cursor = 'not-allowed';
                }
                // Resetear archivo actual
                window.archivoActual = null;
                
                // Resetear textos
                const lastUpdate = document.getElementById('lastUpdate');
                if (lastUpdate) {
                    lastUpdate.textContent = 'Sin datos cargados';
                }
                
                // Guardar usuario actual
                window.currentUser = username;
                
                // Volver a la secci√≥n de resumen
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById('resumenSection').classList.add('active');
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                document.querySelectorAll('.nav-item')[0].classList.add('active');
                
                // Mostrar dashboard
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('bottomNav').classList.add('active');
                errorMessage.style.display = 'none';
                inicializarFiltros();
            } else {
                errorMessage.style.display = 'block';
            }
        }

        function logout() {
            // Resetear estado
            window.archivoActual = null;
            
            // Resetear textos
            const lastUpdate = document.getElementById('lastUpdate');
            if (lastUpdate) {
                lastUpdate.textContent = 'Sin datos cargados';
            }
            
            // Volver a la secci√≥n de resumen
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('resumenSection').classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.nav-item')[0].classList.add('active');
            
            // Ocultar dashboard y mostrar login
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('bottomNav').classList.remove('active');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function inicializarFiltros() {
            const selectDesde = document.getElementById('fechaDesde');
            const selectHasta = document.getElementById('fechaHasta');
            todosMeses.forEach((mes, index) => {
                selectDesde.innerHTML += `<option value="${index}">${mes}</option>`;
                selectHasta.innerHTML += `<option value="${index}">${mes}</option>`;
            });
            selectHasta.value = todosMeses.length - 1;

            const selectDesdeInt = document.getElementById('fechaDesdeInteranual');
            const selectHastaInt = document.getElementById('fechaHastaInteranual');
            todosMeses.forEach((mes, index) => {
                selectDesdeInt.innerHTML += `<option value="${index}">${mes}</option>`;
                selectHastaInt.innerHTML += `<option value="${index}">${mes}</option>`;
            });
            selectHastaInt.value = todosMeses.length - 1;

            const selectDesdeEmae = document.getElementById('fechaDesdeEmae');
            const selectHastaEmae = document.getElementById('fechaHastaEmae');
            todosMeses.forEach((mes, index) => {
                if (todosEmae[index] !== null) {
                    selectDesdeEmae.innerHTML += `<option value="${index}">${mes}</option>`;
                    selectHastaEmae.innerHTML += `<option value="${index}">${mes}</option>`;
                }
            });
            selectHastaEmae.value = todosMeses.length - 2;
        }

        function aplicarFiltroMensual() {
            filtroMensualDesde = parseInt(document.getElementById('fechaDesde').value);
            filtroMensualHasta = parseInt(document.getElementById('fechaHasta').value);
            if (filtroMensualDesde > filtroMensualHasta) {
                alert('La fecha "Desde" debe ser anterior a "Hasta"');
                return;
            }
            actualizarChartMensual();
        }

        function aplicarFiltroInteranual() {
            filtroInteranualDesde = parseInt(document.getElementById('fechaDesdeInteranual').value);
            filtroInteranualHasta = parseInt(document.getElementById('fechaHastaInteranual').value);
            if (filtroInteranualDesde > filtroInteranualHasta) {
                alert('La fecha "Desde" debe ser anterior a "Hasta"');
                return;
            }
            actualizarChartInteranual();
        }

        function aplicarFiltroEmae() {
            filtroEmaeDesde = parseInt(document.getElementById('fechaDesdeEmae').value);
            filtroEmaeHasta = parseInt(document.getElementById('fechaHastaEmae').value);
            if (filtroEmaeDesde > filtroEmaeHasta) {
                alert('La fecha "Desde" debe ser anterior a "Hasta"');
                return;
            }
            actualizarChartEmae();
        }

        function showSection(section) {
            // Si intenta ir a BCRA, SIEMPRE mostrar modal (incluso si ya tiene datos)
            if (section === 'bcra') {
                mostrarModalUpload();
                return;
            }
            
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(section + 'Section').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const navItems = document.querySelectorAll('.nav-item');
            const sectionMap = { 'resumen': 0, 'mensual': 1, 'interanual': 2, 'emae': 3, 'bcra': 4 };
            if (sectionMap[section] !== undefined) {
                navItems[sectionMap[section]].classList.add('active');
            }
            
            if (!chartsInitialized && section !== 'resumen') {
                initCharts();
                chartsInitialized = true;
            }
            
            window.scrollTo(0, 0);
        }

        function mostrarModalUpload() {
            const modal = document.getElementById('modalUploadBCRA');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            const currentUser = window.currentUser;
            const isAdmin = currentUser === 'admin';
            
            // Verificar si hay archivo del admin guardado
            const adminFileData = localStorage.getItem('archivo_admin');
            
            if (isAdmin) {
                // ADMIN: Puede subir archivo
                document.getElementById('opcionSubir').style.display = 'block';
                
                if (adminFileData) {
                    const fileInfo = JSON.parse(adminFileData);
                    document.getElementById('opcionAdmin').style.display = 'block';
                    document.getElementById('infoAdmin').textContent = 
                        `Archivo: ${fileInfo.nombre} (${formatBytes(fileInfo.tama√±o)}) - Subido: ${new Date(fileInfo.fecha).toLocaleString('es-AR')}`;
                } else {
                    document.getElementById('opcionAdmin').style.display = 'none';
                }
            } else {
                // USUARIO NORMAL: Solo puede ver archivo del admin
                document.getElementById('opcionSubir').style.display = 'none';
                
                if (adminFileData) {
                    const fileInfo = JSON.parse(adminFileData);
                    document.getElementById('opcionAdmin').style.display = 'block';
                    document.getElementById('infoAdmin').textContent = 
                        `Archivo: ${fileInfo.nombre} (${formatBytes(fileInfo.tama√±o)}) - Subido: ${new Date(fileInfo.fecha).toLocaleString('es-AR')}`;
                    
                    // Auto-cargar para usuarios
                    setTimeout(() => verArchivoAdmin(), 300);
                } else {
                    document.getElementById('opcionAdmin').style.display = 'none';
                    const status = document.getElementById('uploadStatus');
                    status.style.display = 'block';
                    status.style.background = 'rgba(239, 68, 68, 0.1)';
                    status.style.color = '#ef4444';
                    status.style.border = '1px solid #ef4444';
                    status.innerHTML = '‚ö†Ô∏è No hay archivos disponibles. Contacta al administrador.';
                }
            }
        }
        
        function cerrarModalSinCargar() {
            document.getElementById('modalUploadBCRA').style.display = 'none';
            document.body.style.overflow = 'auto';
            // Volver a la secci√≥n anterior (resumen)
            showSection('resumen');
        }
        
        function cerrarModalUpload() {
            const modal = document.getElementById('modalUploadBCRA');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Mostrar secci√≥n BCRA
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('bcraSection').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const navItems = document.querySelectorAll('.nav-item');
            navItems[4].classList.add('active');
            
            // Actualizar visor si hay archivo cargado
            if (window.archivoActual) {
                setTimeout(() => mostrarArchivo(window.archivoActual), 100);
            }
            
            window.scrollTo(0, 0);
        }
        
        function usarDatosEjemplo() {
            window.bcraDataLoaded = true;
            document.getElementById('btnContinuar').disabled = false;
            document.getElementById('btnContinuar').style.opacity = '1';
            document.getElementById('btnContinuar').style.cursor = 'pointer';
            
            const status = document.getElementById('uploadStatus');
            status.style.display = 'block';
            status.style.background = 'rgba(34, 197, 94, 0.1)';
            status.style.color = '#22c55e';
            status.style.border = '1px solid #22c55e';
            status.innerHTML = '‚úÖ Usando datos de ejemplo (1 Nov 2025 - 27 Ene 2026)';
        }

        // ==========================================
        // FUNCIONES SIMPLIFICADAS (SIN C√ìDIGOS)
        // ==========================================

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        function procesarArchivo(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const status = document.getElementById('uploadStatus');
            status.style.display = 'block';
            status.style.background = 'rgba(59, 130, 246, 0.1)';
            status.style.color = '#3b82f6';
            status.style.border = '1px solid #3b82f6';
            status.innerHTML = '‚è≥ Subiendo archivo...';
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const fileData = {
                    nombre: file.name,
                    tipo: file.type,
                    tama√±o: file.size,
                    contenido: e.target.result,
                    fecha: new Date().toISOString(),
                    subidoPor: window.currentUser
                };
                
                // Guardar en localStorage
                if (window.currentUser === 'admin') {
                    localStorage.setItem('archivo_admin', JSON.stringify(fileData));
                    console.log('‚úÖ Archivo guardado para todos los usuarios');
                }
                
                // Guardar en memoria para este usuario
                window.archivoActual = fileData;
                
                // Mostrar √©xito
                status.style.background = 'rgba(34, 197, 94, 0.1)';
                status.style.color = '#22c55e';
                status.style.border = '1px solid #22c55e';
                status.innerHTML = `‚úÖ Archivo subido: ${file.name} (${formatBytes(file.size)})`;
                
                if (window.currentUser === 'admin') {
                    status.innerHTML += ' - Guardado para todos';
                }
                
                // Habilitar bot√≥n continuar
                document.getElementById('btnContinuar').disabled = false;
                document.getElementById('btnContinuar').style.opacity = '1';
                document.getElementById('btnContinuar').style.cursor = 'pointer';
                
                // NO actualizar visor aqu√≠ porque el modal est√° abierto
                // Se actualizar√° al cerrar el modal
            };
            
            reader.readAsDataURL(file);
        }
        
        function verArchivoAdmin() {
            const adminFileData = localStorage.getItem('archivo_admin');
            if (!adminFileData) {
                alert('No hay archivos del administrador');
                return;
            }
            
            const fileData = JSON.parse(adminFileData);
            window.archivoActual = fileData;
            
            // Mostrar √©xito en el modal
            const status = document.getElementById('uploadStatus');
            status.style.display = 'block';
            status.style.background = 'rgba(34, 197, 94, 0.1)';
            status.style.color = '#22c55e';
            status.style.border = '1px solid #22c55e';
            status.innerHTML = `‚úÖ Archivo del admin: ${fileData.nombre} (${formatBytes(fileData.tama√±o)})`;
            
            // Habilitar bot√≥n continuar
            document.getElementById('btnContinuar').disabled = false;
            document.getElementById('btnContinuar').style.opacity = '1';
            document.getElementById('btnContinuar').style.cursor = 'pointer';
            
            // NO actualizar visor aqu√≠ porque el modal est√° abierto
            // Se actualizar√° al cerrar el modal
        }
        
        function mostrarArchivo(fileData) {
            const visor = document.getElementById('visorArchivo');
            const lastUpdate = document.getElementById('lastUpdate');
            
            if (!visor) {
                console.error('visorArchivo no encontrado');
                return;
            }
            
            if (lastUpdate) {
                lastUpdate.textContent = `Subido por ${fileData.subidoPor} - ${new Date(fileData.fecha).toLocaleString('es-AR')}`;
            }
            
            // Determinar tipo de archivo y mostrar
            if (fileData.tipo.startsWith('image/')) {
                // Es una imagen
                visor.innerHTML = `
                    <img src="${fileData.contenido}" style="max-width: 100%; max-height: 500px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);" />
                    <p style="color: #94a3b8; margin: 16px 0 0 0; text-align: center; font-size: 14px;">${fileData.nombre}</p>
                    <button onclick="descargarArchivo()" style="margin-top: 16px; padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üì• Descargar
                    </button>
                `;
            } else {
                // Otro tipo de archivo
                const emoji = fileData.tipo.includes('pdf') ? 'üìÑ' : 
                             fileData.tipo.includes('sheet') || fileData.tipo.includes('excel') ? 'üìä' : 
                             fileData.tipo.includes('word') || fileData.tipo.includes('document') ? 'üìù' : 
                             fileData.tipo.includes('zip') || fileData.tipo.includes('rar') ? 'üì¶' :
                             fileData.tipo.includes('video') ? 'üé•' : 'üìÅ';
                
                visor.innerHTML = `
                    <div style="font-size: 64px; margin-bottom: 20px;">${emoji}</div>
                    <h3 style="color: white; margin: 0 0 12px 0; font-size: 24px;">${fileData.nombre}</h3>
                    <p style="color: #94a3b8; margin: 0 0 24px 0;">${formatBytes(fileData.tama√±o)}</p>
                    <button onclick="descargarArchivo()" style="padding: 16px 32px; background: #22c55e; color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                        <span>üì•</span>
                        <span>Descargar</span>
                    </button>
                `;
            }
        }
        
        function descargarArchivo() {
            if (!window.archivoActual) {
                alert('No hay archivo cargado');
                return;
            }
            
            const link = document.createElement('a');
            link.href = window.archivoActual.contenido;
            link.download = window.archivoActual.nombre;
            link.click();
        }

        function cargarSheetJS() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Drag and drop
        window.addEventListener('load', () => {
            const dropZone = document.getElementById('dropZone');
            if (dropZone) {
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.style.borderColor = '#60a5fa';
                    dropZone.style.background = 'rgba(59, 130, 246, 0.2)';
                });
                dropZone.addEventListener('dragleave', () => {
                    dropZone.style.borderColor = '#3b82f6';
                    dropZone.style.background = 'rgba(59, 130, 246, 0.1)';
                });
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.style.borderColor = '#3b82f6';
                    dropZone.style.background = 'rgba(59, 130, 246, 0.1)';
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        document.getElementById('fileInput').files = files;
                        procesarExcelBCRA({ target: { files: files } });
                    }
                });
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
        });

        async function descargarExcel() {
            const btn = event.target.closest('.btn-primary');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span>‚è≥</span><span>Generando...</span>';
            
            try {
                if (typeof ExcelJS === 'undefined') {
                    await loadScript('https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js');
                }
                
                const workbook = new ExcelJS.Workbook();
                const ws = workbook.addWorksheet('Datos Completos');
                ws.addRow(['Mes', 'Inflaci√≥n Mensual (%)', 'Inflaci√≥n Interanual (%)', 'EMAE Desest. (base 2004=100)']);
                for (let i = 0; i < todosMeses.length; i++) {
                    ws.addRow([todosMeses[i], todosInflacionMensual[i], todosInflacionInteranual[i], todosEmae[i]]);
                }
                formatWorksheet(ws);
                
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'inflacion_argentina_2023-2025.xlsx';
                a.click();
                window.URL.revokeObjectURL(url);
                
                btn.innerHTML = '<span>‚úÖ</span><span>Descargado!</span>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Error:', error);
                btn.innerHTML = '<span>‚ùå</span><span>Error</span>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            }
        }

        function formatWorksheet(worksheet) {
            const headerRow = worksheet.getRow(1);
            headerRow.font = { bold: true, color: { argb: 'FFFFFFFF' } };
            headerRow.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF0f172a' } };
            headerRow.alignment = { horizontal: 'center', vertical: 'middle' };
            worksheet.getColumn(1).width = 12;
            worksheet.getColumn(2).width = 24;
            worksheet.getColumn(3).width = 26;
            worksheet.getColumn(4).width = 30;
            for (let i = 2; i <= worksheet.rowCount; i++) {
                for (let j = 2; j <= 4; j++) {
                    worksheet.getCell(i, j).numFmt = '0.0';
                    worksheet.getCell(i, j).alignment = { horizontal: 'center' };
                }
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        function initCharts() {
            Chart.defaults.color = '#cbd5e1';
            Chart.defaults.font.family = "'Inter', sans-serif";
            
            crearChartMensual();
            crearChartInteranual();
            crearChartEmae();
        }

        function crearChartMensual() {
            const meses = todosMeses.slice(filtroMensualDesde, filtroMensualHasta + 1);
            const inflacion = todosInflacionMensual.slice(filtroMensualDesde, filtroMensualHasta + 1);
            const emae = todosEmae.slice(filtroMensualDesde, filtroMensualHasta + 1);

            const ctx = document.getElementById('inflacionMensualChart').getContext('2d');
            if (chartMensual) chartMensual.destroy();
            
            chartMensual = new Chart(ctx, {
                type: 'bar',
                plugins: [ChartDataLabels],
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Inflaci√≥n Mensual (%)',
                        data: inflacion,
                        backgroundColor: function(context) {
                            const gradient = context.chart.ctx.createLinearGradient(0, 0, 0, 400);
                            gradient.addColorStop(0, '#3b82f6');
                            gradient.addColorStop(1, '#1e40af');
                            return gradient;
                        },
                        borderRadius: 6,
                        borderSkipped: false,
                        yAxisID: 'y',
                        order: 2
                    },
                    {
                        label: 'EMAE Desest. (base 2004=100)',
                        data: emae,
                        type: 'line',
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false,
                        pointRadius: 0,
                        pointHoverRadius: 0,
                        yAxisID: 'y1',
                        order: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: null },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#cbd5e1',
                                font: { size: 13, weight: '600' },
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: { enabled: false },
                        datalabels: {
                            display: function(context) {
                                const datasetIndex = context.datasetIndex;
                                const dataIndex = context.dataIndex;
                                
                                // Para dataset 0 (inflaci√≥n), mostrar TODAS
                                if (datasetIndex === 0) {
                                    return true;
                                }
                                
                                // Para dataset 1 (EMAE), solo primera y √∫ltima v√°lida
                                if (datasetIndex === 1) {
                                    const data = context.dataset.data;
                                    if (!data[dataIndex] || data[dataIndex] === null) return false;
                                    
                                    // Encontrar primer y √∫ltimo √≠ndice v√°lido
                                    let firstValid = -1;
                                    let lastValid = -1;
                                    for (let i = 0; i < data.length; i++) {
                                        if (data[i] !== null && data[i] !== undefined) {
                                            if (firstValid === -1) firstValid = i;
                                            lastValid = i;
                                        }
                                    }
                                    
                                    return dataIndex === firstValid || dataIndex === lastValid;
                                }
                                
                                return false;
                            },
                            anchor: function(context) {
                                // Inflaci√≥n: arriba de las barras
                                // EMAE: abajo de la l√≠nea
                                return context.datasetIndex === 0 ? 'end' : 'end';
                            },
                            align: function(context) {
                                // Inflaci√≥n: alineado arriba
                                // EMAE: alineado abajo
                                return context.datasetIndex === 0 ? 'end' : 'bottom';
                            },
                            rotation: function(context) {
                                // Inflaci√≥n: vertical (-90 grados)
                                // EMAE: horizontal (0 grados)
                                return context.datasetIndex === 0 ? -90 : 0;
                            },
                            offset: function(context) {
                                // Inflaci√≥n: offset peque√±o
                                // EMAE: offset mayor para separar de la l√≠nea
                                return context.datasetIndex === 0 ? 2 : 8;
                            },
                            clip: false,
                            font: { 
                                family: 'Inter', 
                                size: 10, 
                                weight: 'bold' 
                            },
                            color: function(context) {
                                return context.datasetIndex === 0 ? '#ffffff' : '#10b981';
                            },
                            formatter: function(value, context) {
                                if (value === null || value === undefined) return '';
                                if (context.datasetIndex === 0) {
                                    return value + '%';
                                }
                                return value.toFixed(1);
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            beginAtZero: true,
                            display: false,
                            grid: { display: false }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            display: false,
                            min: 140,
                            max: 155,
                            grid: { display: false }
                        },
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 10 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function crearChartInteranual() {
            const meses = todosMeses.slice(filtroInteranualDesde, filtroInteranualHasta + 1);
            const interanual = todosInflacionInteranual.slice(filtroInteranualDesde, filtroInteranualHasta + 1);

            const ctx = document.getElementById('inflacionInteranualChart').getContext('2d');
            if (chartInteranual) chartInteranual.destroy();
            
            chartInteranual = new Chart(ctx, {
                type: 'line',
                plugins: [ChartDataLabels],
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Inflaci√≥n Interanual (%)',
                        data: interanual,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointBackgroundColor: '#8b5cf6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: null },
                    layout: {
                        padding: {
                            top: 30,
                            right: 20,
                            bottom: 10,
                            left: 10
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#cbd5e1',
                                font: { size: 13, weight: '600' },
                                padding: 20
                            }
                        },
                        tooltip: { enabled: false },
                        datalabels: {
                            display: function(context) {
                                const dataIndex = context.dataIndex;
                                const data = context.dataset.data;
                                const totalPoints = data.length;
                                
                                // Primer dato
                                if (dataIndex === 0) return true;
                                
                                // √öltimo dato
                                if (dataIndex === totalPoints - 1) return true;
                                
                                // Valor m√°ximo
                                const maxValue = Math.max(...data);
                                if (data[dataIndex] === maxValue) return true;
                                
                                return false;
                            },
                            anchor: 'end',
                            align: 'top',
                            offset: 6,
                            clip: false,
                            font: { 
                                family: 'Inter', 
                                size: 11, 
                                weight: 'bold' 
                            },
                            color: '#ffffff',
                            formatter: function(value) { 
                                if (value === null || value === undefined) return '';
                                return value + '%'; 
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            display: false,
                            grid: { display: false }
                        },
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 10 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function crearChartEmae() {
            const meses = todosMeses.slice(filtroEmaeDesde, filtroEmaeHasta + 1);
            const emae = todosEmae.slice(filtroEmaeDesde, filtroEmaeHasta + 1);

            const ctx = document.getElementById('emaeChart').getContext('2d');
            if (chartEmae) chartEmae.destroy();
            
            chartEmae = new Chart(ctx, {
                type: 'line',
                plugins: [ChartDataLabels],
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'EMAE Desestacionalizado (base 2004=100)',
                        data: emae,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: null },
                    layout: {
                        padding: {
                            top: 30,
                            right: 20,
                            bottom: 10,
                            left: 10
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#cbd5e1',
                                font: { size: 13, weight: '600' },
                                padding: 20
                            }
                        },
                        tooltip: { enabled: false },
                        datalabels: {
                            display: function(context) {
                                const dataIndex = context.dataIndex;
                                const data = context.dataset.data;
                                const value = data[dataIndex];
                                
                                // No mostrar si es null
                                if (value === null || value === undefined) return false;
                                
                                // Primer dato v√°lido
                                if (dataIndex === 0) return true;
                                
                                // Encontrar el √∫ltimo √≠ndice v√°lido
                                let lastValid = -1;
                                for (let i = 0; i < data.length; i++) {
                                    if (data[i] !== null && data[i] !== undefined) {
                                        lastValid = i;
                                    }
                                }
                                if (dataIndex === lastValid) return true;
                                
                                // Valor m√°ximo (solo considerar valores no-null)
                                const validValues = data.filter(v => v !== null && v !== undefined);
                                const maxValue = Math.max(...validValues);
                                if (value === maxValue) return true;
                                
                                return false;
                            },
                            anchor: 'end',
                            align: 'top',
                            offset: 6,
                            clip: false,
                            font: { 
                                family: 'Inter', 
                                size: 11, 
                                weight: 'bold' 
                            },
                            color: '#ffffff',
                            formatter: function(value) {
                                if (value === null || value === undefined) return '';
                                return value.toFixed(1);
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            display: false,
                            min: 140,
                            max: 155,
                            grid: { display: false }
                        },
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 10 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function actualizarChartMensual() {
            crearChartMensual();
        }

        function actualizarChartInteranual() {
            crearChartInteranual();
        }

        function actualizarChartEmae() {
            crearChartEmae();
        }

        function crearChartBCRA() {
            const ctx = document.getElementById('bcraChart').getContext('2d');
            if (chartBcra) chartBcra.destroy();
            
            // Formatear fechas para mostrar (mostrar cada 7 d√≠as para legibilidad)
            const labelsFormateados = fechasBCRA.map((fecha, index) => {
                // Mostrar cada 7 d√≠as + primero y √∫ltimo
                if (index === 0 || index === fechasBCRA.length - 1 || index % 7 === 0) {
                    const d = new Date(fecha);
                    return `${d.getDate()}/${d.getMonth() + 1}`;
                }
                return '';
            });
            
            chartBcra = new Chart(ctx, {
                type: 'line',
                plugins: [ChartDataLabels],
                data: {
                    labels: labelsFormateados,
                    datasets: [{
                        label: 'Base Monetaria (millones $)',
                        data: baseMonetaria,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: function(context) {
                            const index = context.dataIndex;
                            // Mostrar puntos cada 7 d√≠as + primero y √∫ltimo
                            if (index === 0 || index === baseMonetaria.length - 1 || index % 7 === 0) {
                                return 5;
                            }
                            return 0;
                        },
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: null },
                    layout: {
                        padding: {
                            top: 30,
                            right: 20,
                            bottom: 10,
                            left: 10
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#cbd5e1',
                                font: { size: 13, weight: '600' },
                                padding: 20
                            }
                        },
                        tooltip: { enabled: false },
                        datalabels: {
                            display: function(context) {
                                const dataIndex = context.dataIndex;
                                const data = context.dataset.data;
                                const totalPoints = data.length;
                                
                                // Primer dato
                                if (dataIndex === 0) return true;
                                
                                // √öltimo dato
                                if (dataIndex === totalPoints - 1) return true;
                                
                                // Valor m√°ximo
                                const maxValue = Math.max(...data);
                                if (data[dataIndex] === maxValue) return true;
                                
                                return false;
                            },
                            anchor: 'end',
                            align: 'top',
                            offset: 6,
                            clip: false,
                            font: { 
                                family: 'Inter', 
                                size: 11, 
                                weight: 'bold' 
                            },
                            color: '#ffffff',
                            formatter: function(value) {
                                if (value === null || value === undefined) return '';
                                // Formatear en billones
                                const billones = (value / 1000000).toFixed(1);
                                return billones + 'B';
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            display: false,
                            grid: { display: false }
                        },
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 10 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

    </script>
</body>
</html>
